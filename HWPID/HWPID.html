<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PID Loop Settings Calculator</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for Inter font and general body styling */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8; /* Light blue-gray background */
            display: flex;
            justify-content: center;
            align-items: flex-start; /* Align to top for better scrolling */
            min-height: 100vh;
            padding: 2rem;
            box-sizing: border-box;
        }
        .container {
            max-width: 800px;
            width: 100%;
            background-color: #ffffff;
            border-radius: 1.5rem; /* More rounded corners */
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
            padding: 2.5rem;
            box-sizing: border-box;
        }
        input[type="number"] {
            -moz-appearance: textfield; /* Firefox */
        }
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-4xl font-extrabold text-center text-gray-900 mb-8">
            Hot Water PID Loop Calculator
        </h1>

        <p class="text-gray-700 text-lg mb-8 text-center leading-relaxed">
            This calculator helps you understand the impact of Proportional (P), Integral (I), and Derivative (D) settings on a hot water system's control output. Adjust the parameters below to see how they influence the system's response.
        </p>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
            <!-- Process Variables -->
            <div class="bg-blue-50 p-6 rounded-xl shadow-inner">
                <h2 class="text-2xl font-semibold text-blue-800 mb-4">Process Variables</h2>
                <div class="mb-4">
                    <label for="setpoint" class="block text-gray-700 text-sm font-medium mb-2">Setpoint (°F):</label>
                    <input type="number" id="setpoint" value="140.0" step="0.5"
                           class="w-full p-3 border border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 ease-in-out text-lg">
                </div>
                <div class="mb-0">
                    <label for="processVariable" class="block text-gray-700 text-sm font-medium mb-2">Current Temperature (°F):</label>
                    <input type="number" id="processVariable" value="130.0" step="0.5"
                           class="w-full p-3 border border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 ease-in-out text-lg">
                </div>
            </div>

            <!-- PID Settings -->
            <div class="bg-green-50 p-6 rounded-xl shadow-inner">
                <h2 class="text-2xl font-semibold text-green-800 mb-4">PID Settings</h2>
                <div class="mb-4">
                    <label for="proportionalBand" class="block text-gray-700 text-sm font-medium mb-2">Proportional Band (%):</label>
                    <input type="number" id="proportionalBand" value="50.0" step="1.0"
                           class="w-full p-3 border border-green-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition duration-200 ease-in-out text-lg">
                    <p class="text-xs text-gray-500 mt-1">Lower value = more aggressive P action.</p>
                </div>
                <div class="mb-4">
                    <label for="integralTime" class="block text-gray-700 text-sm font-medium mb-2">Integral Time (minutes):</label>
                    <input type="number" id="integralTime" value="1.0" step="0.1"
                           class="w-full p-3 border border-green-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition duration-200 ease-in-out text-lg">
                    <p class="text-xs text-gray-500 mt-1">Time for integral action to repeat proportional action. Set to 0 for no integral action.</p>
                </div>
                <div class="mb-0">
                    <label for="derivativeTime" class="block text-gray-700 text-sm font-medium mb-2">Derivative Time (minutes):</label>
                    <input type="number" id="derivativeTime" value="0.0" step="0.1"
                           class="w-full p-3 border border-green-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition duration-200 ease-in-out text-lg">
                    <p class="text-xs text-gray-500 mt-1">Time for derivative action to anticipate proportional action. Set to 0 for no derivative action.</p>
                </div>
            </div>
        </div>

        <!-- Output Settings -->
        <div class="bg-purple-50 p-6 rounded-xl shadow-inner mb-8">
            <h2 class="text-2xl font-semibold text-purple-800 mb-4">Output Settings</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div>
                    <label for="outputBias" class="block text-gray-700 text-sm font-medium mb-2">Output Bias (%):</label>
                    <input type="number" id="outputBias" value="50.0" step="1.0"
                           class="w-full p-3 border border-purple-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition duration-200 ease-in-out text-lg">
                    <p class="text-xs text-gray-500 mt-1">Baseline output when error is zero.</p>
                </div>
                <div>
                    <label for="outputMin" class="block text-gray-700 text-sm font-medium mb-2">Minimum Output (%):</label>
                    <input type="number" id="outputMin" value="0.0" step="1.0"
                           class="w-full p-3 border border-purple-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition duration-200 ease-in-out text-lg">
                </div>
                <div>
                    <label for="outputMax" class="block text-gray-700 text-sm font-medium mb-2">Maximum Output (%):</label>
                    <input type="number" id="outputMax" value="100.0" step="1.0"
                           class="w-full p-3 border border-purple-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition duration-200 ease-in-out text-lg">
                </div>
            </div>
        </div>

        <button id="calculateBtn"
                class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-4 px-6 rounded-xl shadow-lg hover:shadow-xl transition duration-300 ease-in-out transform hover:-translate-y-1 mb-8 text-xl">
            Calculate PID Impact
        </button>

        <!-- Results Section -->
        <div id="results" class="bg-gray-100 p-6 rounded-xl shadow-inner border border-gray-200">
            <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center">Calculation Results</h2>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div class="p-4 bg-white rounded-lg shadow-sm border border-gray-200">
                    <h3 class="text-xl font-semibold text-gray-700 mb-2">Error:</h3>
                    <p id="errorResult" class="text-3xl font-extrabold text-red-600">0.0 °F</p>
                </div>
                <div class="p-4 bg-white rounded-lg shadow-sm border border-gray-200">
                    <h3 class="text-xl font-semibold text-gray-700 mb-2">Proportional Gain (Kp):</h3>
                    <p id="kpResult" class="text-3xl font-extrabold text-blue-600">0.0</p>
                </div>
            </div>

            <div class="p-4 bg-white rounded-lg shadow-sm border border-gray-200 mb-6">
                <h3 class="text-xl font-semibold text-gray-700 mb-2">Proportional Contribution:</h3>
                <p id="proportionalContributionResult" class="text-3xl font-extrabold text-green-600">0.0 %</p>
                <p class="text-sm text-gray-500 mt-2">
                    This is the output change directly proportional to the current error. A larger error leads to a larger proportional output.
                </p>
            </div>

            <div class="p-4 bg-white rounded-lg shadow-sm border border-gray-200 mb-6">
                <h3 class="text-xl font-semibold text-gray-700 mb-2">Estimated Instantaneous Output (P-only):</h3>
                <p id="estimatedOutputResult" class="text-4xl font-extrabold text-indigo-700">0.0 %</p>
                <p class="text-sm text-gray-500 mt-2">
                    This is the output considering only the proportional action and the output bias.
                    In a real system, the Integral and Derivative terms would further adjust this value over time.
                </p>
            </div>

            <div class="p-4 bg-white rounded-lg shadow-sm border border-gray-200 mb-6">
                <h3 class="text-xl font-semibold text-gray-700 mb-2">Integral (I) Action:</h3>
                <p class="text-gray-700 mb-2">
                    The Integral action eliminates steady-state errors by accumulating the error over time. If the Process Variable consistently stays below the Setpoint, the Integral term will gradually increase the output, pushing the PV towards the Setpoint.
                </p>
                <p id="kiExplanation" class="text-sm text-gray-500 mt-2">
                    Integral Gain (Ki) = Kp / Integral Time. A smaller Integral Time means faster integral action (more aggressive).
                </p>
                <p id="kiResult" class="text-xl font-bold text-orange-600 mt-2">Ki: 0.0</p>
            </div>

            <div class="p-4 bg-white rounded-lg shadow-sm border border-gray-200">
                <h3 class="text-xl font-semibold text-gray-700 mb-2">Derivative (D) Action:</h3>
                <p class="text-gray-700 mb-2">
                    The Derivative action anticipates future errors by responding to the rate of change of the Process Variable. If the PV is rapidly approaching the Setpoint, the Derivative term will reduce the output to prevent overshoot. Conversely, if the PV is rapidly moving away, it will increase the output.
                </p>
                <p id="kdExplanation" class="text-sm text-gray-500 mt-2">
                    Derivative Gain (Kd) = Kp * Derivative Time. A larger Derivative Time means more aggressive derivative action.
                </p>
                <p id="kdResult" class="text-xl font-bold text-purple-600 mt-2">Kd: 0.0</p>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const setpointInput = document.getElementById('setpoint');
            const processVariableInput = document.getElementById('processVariable');
            const proportionalBandInput = document.getElementById('proportionalBand');
            const integralTimeInput = document.getElementById('integralTime');
            const derivativeTimeInput = document.getElementById('derivativeTime');
            const outputBiasInput = document.getElementById('outputBias');
            const outputMinInput = document.getElementById('outputMin');
            const outputMaxInput = document.getElementById('outputMax');
            const calculateBtn = document.getElementById('calculateBtn');

            const errorResult = document.getElementById('errorResult');
            const kpResult = document.getElementById('kpResult');
            const proportionalContributionResult = document.getElementById('proportionalContributionResult');
            const estimatedOutputResult = document.getElementById('estimatedOutputResult');
            const kiResult = document.getElementById('kiResult');
            const kdResult = document.getElementById('kdResult');

            function calculatePID() {
                // Get input values
                const setpoint = parseFloat(setpointInput.value);
                const processVariable = parseFloat(processVariableInput.value);
                const proportionalBand = parseFloat(proportionalBandInput.value);
                const integralTime = parseFloat(integralTimeInput.value);
                const derivativeTime = parseFloat(derivativeTimeInput.value);
                const outputBias = parseFloat(outputBiasInput.value);
                const outputMin = parseFloat(outputMinInput.value);
                const outputMax = parseFloat(outputMaxInput.value);

                // Validate inputs
                if (isNaN(setpoint) || isNaN(processVariable) || isNaN(proportionalBand) ||
                    isNaN(integralTime) || isNaN(derivativeTime) || isNaN(outputBias) ||
                    isNaN(outputMin) || isNaN(outputMax)) {
                    // Replaced alert with console.error and return for better user experience in an iframe
                    console.error('Please enter valid numbers for all fields.');
                    return;
                }

                if (proportionalBand <= 0) {
                    console.error('Proportional Band must be greater than 0.');
                    return;
                }

                if (outputMin >= outputMax) {
                    console.error('Minimum Output must be less than Maximum Output.');
                    return;
                }

                // 1. Calculate Error
                const error = setpoint - processVariable;
                errorResult.textContent = `${error.toFixed(1)} °F`; // Changed to °F

                // 2. Calculate Proportional Gain (Kp)
                // Kp = 100 / Proportional Band (if PB is in percent)
                const kp = 100 / proportionalBand;
                kpResult.textContent = kp.toFixed(2);

                // 3. Calculate Proportional Contribution
                // This is the immediate change in output due to the current error.
                const proportionalContribution = kp * error;
                proportionalContributionResult.textContent = `${proportionalContribution.toFixed(2)} %`;

                // 4. Calculate Estimated Instantaneous Output (P-only with bias)
                // This is the output considering only the proportional action and the output bias.
                // In a real system, I and D would adjust this dynamically.
                let estimatedOutput = outputBias + proportionalContribution;

                // Clamp the output to the defined min/max range
                estimatedOutput = Math.max(outputMin, Math.min(outputMax, estimatedOutput));
                estimatedOutputResult.textContent = `${estimatedOutput.toFixed(2)} %`;

                // 5. Calculate Integral Gain (Ki)
                // Ki = Kp / Integral Time. If Integral Time is 0, Ki is effectively 0 (no integral action).
                const ki = integralTime > 0 ? kp / integralTime : 0;
                kiResult.textContent = `Ki: ${ki.toFixed(2)}`;

                // 6. Calculate Derivative Gain (Kd)
                // Kd = Kp * Derivative Time. If Derivative Time is 0, Kd is effectively 0 (no derivative action).
                const kd = derivativeTime > 0 ? kp * derivativeTime : 0;
                kdResult.textContent = `Kd: ${kd.toFixed(2)}`;
            }

            // Attach event listener to the button
            calculateBtn.addEventListener('click', calculatePID);

            // Initial calculation on load
            calculatePID();

            // Add event listeners to input fields for real-time updates (optional, but good for calculators)
            const inputs = document.querySelectorAll('input[type="number"]');
            inputs.forEach(input => {
                input.addEventListener('input', calculatePID);
            });
        });
    </script>
</body>
</html>
